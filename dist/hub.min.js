!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self,function(){var o=e.Cookies,r=e.Cookies=t();r.noConflict=function(){return e.Cookies=o,r}}())}(this,function(){"use strict";function e(e){for(var t=1;t<arguments.length;t++){var o=arguments[t];for(var r in o)e[r]=o[r]}return e}function t(o,r){function n(t,n,i){if("undefined"!=typeof document){i=e({},r,i),"number"==typeof i.expires&&(i.expires=new Date(Date.now()+864e5*i.expires)),i.expires&&(i.expires=i.expires.toUTCString()),t=encodeURIComponent(t).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var s="";for(var a in i)i[a]&&(s+="; "+a,i[a]!==!0&&(s+="="+i[a].split(";")[0]));return document.cookie=t+"="+o.write(n,t)+s}}function i(e){if("undefined"!=typeof document&&(!arguments.length||e)){for(var t=document.cookie?document.cookie.split("; "):[],r={},n=0;n<t.length;n++){var i=t[n].split("="),s=i.slice(1).join("=");try{var a=decodeURIComponent(i[0]);if(r[a]=o.read(s,a),e===a)break}catch(c){}}return e?r[e]:r}}return Object.create({set:n,get:i,remove:function(t,o){n(t,"",e({},o,{expires:-1}))},withAttributes:function(o){return t(this.converter,e({},this.attributes,o))},withConverter:function(o){return t(e({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(r)},converter:{value:Object.freeze(o)}})}var o={read:function(e){return'"'===e[0]&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}},r=t(o,{path:"/"});return r}),function(e){var t=function(e,t){this._Cookies=e.withAttributes(t)};t.prototype={getItem:function(e){var t=this._Cookies.get(e);return void 0!==t?t:null},setItem:function(e,t,o){this._Cookies.set(e,t,o)},removeItem:function(e,t){this._Cookies.remove(e,t)},get length(){var e=this._Cookies.get();return Object.keys(e).length},key:function(e){var t=this._Cookies.get();return Object.keys(t)[e]},clear:function(){var e=this._Cookies.get();Object.keys(e).forEach(function(e){this._Cookies.remove(e)},this)}};var o={};o.init=function(r,n){var i=!0;try{window.localStorage||(i=!1),window.sessionStorage||(i=!1)}catch(s){i=!1}if(!i)try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(s){return}o._stores={undefined:window.localStorage,localStorage:window.localStorage,sessionStorage:window.sessionStorage},e.Cookies&&(o._stores.cookieStorage=new t(e.Cookies,n)),o._permissions=r||[],o._installListener(),window.parent.postMessage("cross-storage:ready","*")},o._installListener=function(){var e=o._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},o._listener=function(e){var t,r,n,i,s,a,c;if(t="null"===e.origin?"file://":e.origin,"cross-storage:poll"===e.data)return window.parent.postMessage("cross-storage:ready",e.origin);if("cross-storage:ready"!==e.data){try{n=JSON.parse(e.data)}catch(u){return}if(n&&"string"==typeof n.method&&(i=n.method.split("cross-storage:")[1])){if(o._permitted(t,i))try{a=o["_"+i](n.params)}catch(u){s=u.message}else s="Invalid permissions for "+i;c=JSON.stringify({id:n.id,error:s,result:a}),r="file://"===t?"*":t,window.parent.postMessage(c,r)}}},o._permitted=function(e,t){var r,n,i,s;if(r=["get","set","del","clear","getKeys"],!o._inArray(t,r))return!1;for(n=0;n<o._permissions.length;n++)if(i=o._permissions[n],i.origin instanceof RegExp&&i.allow instanceof Array&&(s=i.origin.test(e),s&&o._inArray(t,i.allow)))return!0;return!1},o._set=function(e){this._stores[e.store].setItem(e.key,e.value,e.attrs)},o._get=function(e){var t,o,r,n;for(t=this._stores[e.store],o=[],r=0;r<e.keys.length;r++){try{n=t.getItem(e.keys[r])}catch(i){n=null}o.push(n)}return o.length>1?o:o[0]},o._del=function(e){for(var t=this._stores[e.store],o=0;o<e.keys.length;o++)t.removeItem(e.keys[o])},o._clear=function(e){this._stores[e.store].clear()},o._getKeys=function(e){var t,o,r,n;for(r=[],n=this._stores[e.store],o=n.length,t=0;o>t;t++)r.push(n.key(t));return r},o._inArray=function(e,t){for(var o=0;o<t.length;o++)if(e===t[o])return!0;return!1},o._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()},"undefined"!=typeof module&&module.exports?module.exports=o:"undefined"!=typeof exports?exports.CrossStorageHub=o:"function"==typeof define&&define.amd?define([],function(){return o}):e.CrossStorageHub=o}(this);